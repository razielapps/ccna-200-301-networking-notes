Of course. Let's proceed.

Topic 11: DHCP Snooping

DHCP is a critical protocol that automatically assigns IP addresses to clients. However, it is inherently trusting. A malicious user can connect a rogue DHCP server to the network and respond to client requests faster than the legitimate server. This is called a DHCP spoofing attack. The rogue server can assign itself as the default gateway (a man-in-the-middle attack) or assign incorrect DNS servers, redirecting users to fake websites.

DHCP Snooping is a security feature on switches that acts as a firewall between untrusted hosts and trusted DHCP servers. It determines which switch ports are allowed to send DHCP server responses. The primary goal is to prevent rogue DHCP servers from operating on the network.

How DHCP Snooping Works:
1. The network administrator configures the switch ports as either trusted or untrusted.
Trusted Ports: These are ports where legitimate DHCP server responses are expected. This includes ports connected to your official DHCP servers, other switches, or routers. The switch allows DHCP server messages (like DHCPOFFER and DHCPACK) only from trusted ports.
Untrusted Ports: These are ports where only DHCP client requests are expected, such as ports connecting to user PCs, printers, and phones. The switch blocks any DHCP server messages coming from untrusted ports.

2. When DHCP Snooping is enabled, the switch listens to DHCP messages on all ports.
When a client on an untrusted port sends a DHCPDISCOVER message, the switch allows it.
If a DHCPOFFER message arrives from an untrusted port, the switch blocks it and can log the event.

3. DHCP Snooping Binding Table:
As the switch observes the DHCP process, it builds a binding table. This table contains information such as the client's MAC address, the assigned IP address, the lease time, the VLAN, and the switch port where the client is connected. This table is built dynamically by listening to DHCP exchanges.

This binding table is also used by other security features like Dynamic ARP Inspection (DAI) and IP Source Guard.

Configuration Steps for DHCP Snooping:
Step 1: Enable DHCP Snooping globally.
Switch(config)# ip dhcp snooping
Step 2: Enable DHCP Snooping for specific VLANs.
Switch(config)# ip dhcp snooping vlan 10,20
Step 3: Configure trusted ports. By default, all ports are untrusted after enabling DHCP snooping.
Switch(config)# interface gigabitethernet 0/1 (This port is connected to the legitimate DHCP server)
Switch(config-if)# ip dhcp snooping trust

Verification Commands:
show ip dhcp snooping: Shows the global status and trusted interfaces.
show ip dhcp snooping binding: Displays the dynamically built binding table.

Assignment 11: Configuring DHCP Snooping to Mitigate a Rogue DHCP Server

Objective: To configure DHCP Snooping to protect the network from a rogue DHCP server.
1. In Packet Tracer, create a topology with one switch (SW1), one legitimate DHCP server, one rogue DHCP server, and two PCs.
2. Connect the legitimate DHCP server to port Gi0/1 on SW1. Configure it with a scope (e.g., 192.168.1.0/24, gateway 192.168.1.1).
3. Connect the rogue DHCP server to port Gi0/2 on SW1. Configure it with a different, incorrect scope (e.g., 169.254.100.0/24, gateway 169.254.100.1) to simulate a malicious configuration.
4. Connect PC1 and PC2 to ports Gi0/3 and Gi0/4.
5. Initially, without DHCP Snooping, set both PCs to obtain IP addresses via DHCP. One PC might get a correct address from the legitimate server, and the other might get a wrong address from the rogue server, demonstrating the problem. You may need to disconnect and reconnect the PCs to see them get different addresses.
6. Now, configure DHCP Snooping on the switch.
   SW1(config)# ip dhcp snooping
   SW1(config)# ip dhcp snooping vlan 1
   SW1(config)# interface gigabitethernet 0/1
   SW1(config-if)# ip dhcp snooping trust (This is the port to the legitimate server)
   (Do not configure trust on Gi0/2, the rogue server port. It remains untrusted by default.)
7. Clear the DHCP leases on the PCs and try to obtain new addresses. Now, both PCs should only receive correct IP addresses from the legitimate server.
8. The rogue server's DHCPOFFER packets are now being blocked by the switch when they try to enter through the untrusted port Gi0/2.
9. Verify the configuration.
   Run show ip dhcp snooping on SW1 to see the global status and list of trusted ports.
   Run show ip dhcp snooping binding to see the MAC addresses, IP addresses, and ports of PC1 and PC2.

Glossary for Topic 11:
DHCP Snooping: A security feature that filters DHCP messages and builds a binding table.
Trusted Port: A switch port allowed to send DHCP server responses.
Untrusted Port: A switch port where DHCP server responses are blocked.
Binding Table: A database built by DHCP snooping that maps client information.

Are you ready to proceed to the next topic, Dynamic ARP Inspection?